<!DOCTYPE html>
<html  dir="ltr" lang="en" data-theme=""><head>
    <title> instantiator.dev | Building AI into your application with Semantic Kernel </title>

    
    <meta charset="utf-8"><meta name="generator" content="Hugo 0.120.3"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="description" content="tech, volunteers, public safety, articles and ideas">
    
    
    
    <link rel="stylesheet"
        href="/css/style.min.59fe2a27cd19eafc8c4aef4e2c18a287287097d0516d9baf6ade257c0f4b4d64.css"
        integrity="sha256-Wf4qJ80Z6vyMSu9OLBiihyhwl9BRbZuvat4lfA9LTWQ="
        crossorigin="anonymous"
        type="text/css">
    

    
    <link rel="stylesheet"
        href="/css/additional-classes.min.1d76732c34340c3588f50dacb5d8ce67a8c9ad2bf0140c8eb825f3f4e3a071c4.css"
        integrity="sha256-HXZzLDQ0DDWI9Q2stdjOZ6jJrSvwFAyOuCXz9OOgccQ="
        crossorigin="anonymous"
        type="text/css">

    
    <link rel="stylesheet"
        href="/css/markupHighlight.min.59c08a266e8a6489aab7cb3ace4259db920d0e8893682a44ef8401387af97664.css"
        integrity="sha256-WcCKJm6KZImqt8s6zkJZ25INDoiTaCpE74QBOHr5dmQ="
        crossorigin="anonymous"
        type="text/css">
    



    <link rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" 
    integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" 
    crossorigin="anonymous" />

    
    <link rel="shortcut icon" href="/favicons/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">

    <link rel="canonical" href="/post/you-too-can-llm/">

    
    
    
    
    <script type="text/javascript"
            src="/js/anatole-header.min.df804b63b5bd8474ea0756ea874bc8f1e92552708cc6ea43aa0d76981dc419f9.js"
            integrity="sha256-34BLY7W9hHTqB1bqh0vI8eklUnCMxupDqg12mB3EGfk="
            crossorigin="anonymous"></script>


    
        
        
        <script type="text/javascript"
                src="/js/anatole-theme-switcher.min.ea8ebe268922ef9849261a1312cd65b640595e65251ce4c00534a176afd1ac0c.js"
                integrity="sha256-6o6&#43;Joki75hJJhoTEs1ltkBZXmUlHOTABTShdq/RrAw="
                crossorigin="anonymous"></script>
    
    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://instantiator.dev/sk/sk-logo.png"/>

<meta name="twitter:title" content="Building AI into your application with Semantic Kernel"/>
<meta name="twitter:description" content="This is a quick guide to some of the features of the Semantic Kernel, a Software Development Kit that simplifies integration of language models into your own applications."/>


    
    <meta property="og:title" content="Building AI into your application with Semantic Kernel" />
<meta property="og:description" content="This is a quick guide to some of the features of the Semantic Kernel, a Software Development Kit that simplifies integration of language models into your own applications." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://instantiator.dev/post/you-too-can-llm/" /><meta property="og:image" content="https://instantiator.dev/sk/sk-logo.png" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-04-17T21:00:00+00:00" />
<meta property="article:modified_time" content="2023-04-17T21:00:00+00:00" /><meta property="og:site_name" content="instantiator.dev" />




</head>
<body><div class="sidebar animated fadeInDown ">
    <div class="logo-title">
        <div class="title">
            <img src="/lewis/profile.jpg" alt="profile picture">
            <h3 title=""><a href="/">instantiator.dev</a></h3>
            <div class="description">
                <p>tech, volunteers, public safety, articles and ideas</p>
            </div>
        </div>
    </div>
    <ul class="social-links">
        
            <li>
                <a href="https://mastodon.social/@instantiator" rel="me" aria-label="Mastodon">
                    <i class="fab fa-mastodon fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://twitter.com/instantiator" rel="me" aria-label="Twitter">
                    <i class="fab fa-twitter fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://github.com/instantiator" rel="me" aria-label="GitHub">
                    <i class="fab fa-github fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://www.linkedin.com/in/lewiswestbury" rel="me" aria-label="LinkedIn">
                    <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://www.escapethereview.co.uk/profile/?user_id=11" rel="me" aria-label="Escape the Review">
                    <i class="fas fa-dungeon fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://icgames.net" rel="me" aria-label="International Consensus Games">
                    <i class="fas fa-chess-knight fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://instantiator.dev/index.xml" rel="me" aria-label="RSS">
                    <i class="fas fa-rss fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
    <div class="footer">
        <div class="by_farbox">&copy; Lewis Westbury  2023 </div>
    </div>
</div>
<div class="main">
    <div class="page-top  animated fadeInDown ">
    <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
    </a>
    <ul class="nav" id="navMenu">
        
        
            
            <li><a 
                   href="/"
                        
                   title="">Home</a></li>
        
            
            <li><a 
                   href="/post/"
                        
                   title="">All posts</a></li>
        
            
            <li><a 
                   href="/categories/tool/"
                        
                   title="">Tools</a></li>
        
            
            <li><a 
                   href="/categories/tutorial/"
                        
                   title="">Tutorials</a></li>
        
            
            <li><a 
                   href="/categories/article/"
                        
                   title="">Articles</a></li>
        
            
            <li><a 
                   href="/about/"
                        
                   title="">About</a></li>
        
        
        
            <li class="theme-switch-item">
                <a class="theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
</div>

    <div class="autopagerize_page_element">
        <div class="content">
    <div class="post  animated fadeInDown ">
        <div class="post-content">
            
           <img class="post-thumbnail" src="/sk/sk-logo.png" alt="Thumbnail image">
            
            <div class="post-title">
                <h3>Building AI into your application with Semantic Kernel</h3>
                
                    <div class="info">
                        <em class="fas fa-calendar-day"></em>
                        <span class="date"> 
                                                2023-04-17
                                           </span>
                        <em class="fas fa-stopwatch"></em>
                        <span class="reading-time">8-minute read</span>
                    </div>
                
            </div>

            <p>This is a quick guide to some of the features of the Semantic Kernel, a Software Development Kit that simplifies integration of language models into your own applications.</p>
<h1 id="the-semantic-kernel">The Semantic Kernel</h1>
<p>The Semantic Kernel is in pre-release, and that means it&rsquo;s not complete, and has plenty of improvements coming. Nevertheless, it&rsquo;s a nice tool for interacting with the Large Language Models (LLMs) available from OpenAI, and Azure OpenAI. You can add it to your .NET projects as a library through NuGet, and once installed it makes the complex business of interacting with these APIs simple.</p>
<p><img src="/sk/sk-flow.png" alt="A flow representing the Semantic Kernel&rsquo;s process. An Ask is fed into the Kernel, which then uses the Planner to conduct a number of steps marked S, M, and C. These, then lead to a Get request which is passed off to an LLM API."></p>
<p>I work in C# but Semantic Kernel has support for several languages: C#, Python, and I&rsquo;m given to understand Java (soon!)</p>
<h2 id="concepts">Concepts</h2>
<p>The Semantic Kernel understands two kinds of operation:</p>
<ul>
<li><strong>Semantic functions</strong> - capabilities expressed as instructions in human language</li>
<li><strong>Native functions</strong> - additional capabilities written as code that can be executed locally</li>
</ul>
<p>These functions are grouped together into <strong>Skills</strong> - and a skill can have any number of semantic or native functions.</p>
<p>The Kernel also has a <strong>Planner</strong>, which can decide which functions to chain together to complete an <strong>Ask</strong> (a request made to it in human language).</p>
<p><em>Caveat: Treat everything in this article as a simplification. There&rsquo;s plenty going on beneath the surface of the Semantic Kernel that I don&rsquo;t pretend to understand. For instance, I have some very rudimentary guesses about what the Planner is doing - but it&rsquo;s likely to be a lot more sophisticated than that.</em></p>
<p><em>The Kernel also has some really interesting capabilities relating to Memories and Connectors that I&rsquo;ve not touched on yet. I&rsquo;ll save it for a future post&hellip;</em></p>
<h2 id="getting-started">Getting started</h2>
<p>If you want to jump into a solution you can play around with, check out this repository:</p>
<ul>
<li><a href="https://github.com/instantiator/semantic-kernel-experiment">instantiator/semantic-kernel-experiment</a></li>
</ul>
<p>All you need do is provide it with an OpenAI key to get started. Run it and it&rsquo;ll execute a quick test for you, calling on the Planner to arrange a plan that uses several functions defined in the solution.</p>
<p>What follows is a quick walk-through of what it&rsquo;s doing&hellip;</p>
<h2 id="walk-through">Walk-through</h2>
<h3 id="configuration">Configuration</h3>
<p>Everything starts in <a href="https://github.com/instantiator/semantic-kernel-experiment/blob/main/SKE/Program.cs"><code>SKE.Program.Main()</code></a> - the entrypoint for this console application.</p>
<p>First, it retrieves config from the <code>.env</code> and <code>.secret.env</code> files, and uses that config to build the kernel.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="c1">// configure and create the semantic kernel</span>
</span></span><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">config</span> <span class="p">=</span> <span class="n">RetrieveConfiguration</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">kernel</span> <span class="p">=</span> <span class="n">BuildAndConfigureKernel</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">private</span> <span class="kd">static</span> <span class="n">IKernel</span> <span class="n">BuildAndConfigureKernel</span><span class="p">(</span><span class="n">IConfigurationRoot</span> <span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">kernel</span> <span class="p">=</span> <span class="n">Kernel</span><span class="p">.</span><span class="n">Builder</span><span class="p">.</span><span class="n">Build</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">kernel</span><span class="p">.</span><span class="n">Config</span><span class="p">.</span><span class="n">AddOpenAITextCompletionService</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="p">[</span><span class="s">&#34;serviceId&#34;</span><span class="p">]!,</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="p">[</span><span class="s">&#34;modelId&#34;</span><span class="p">]!,</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="p">[</span><span class="s">&#34;apiKey&#34;</span><span class="p">]!);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">kernel</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>The Kernel configuration is pretty simple - it just wants to know the service and text completion model it should be using, and an API key to be permitted to access it.</p>
<h3 id="skills">Skills</h3>
<p>The Kernel is then used to import the skills defined in the project, and the Planner - a special skill provided by Semantic Kernel.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="c1">// import defined skills, and the planner</span>
</span></span><span class="line"><span class="cl"><span class="n">kernel</span><span class="p">.</span><span class="n">ImportAllSemanticSkills</span><span class="p">(</span><span class="s">&#34;Skills&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">kernel</span><span class="p">.</span><span class="n">ImportAllNativeSkills</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">planner</span> <span class="p">=</span> <span class="n">kernel</span><span class="p">.</span><span class="n">ImportPlannerSkill</span><span class="p">();</span>
</span></span></code></pre></div><p>The various <code>Import*</code> methods are defined as extension methods for <code>IKernel</code> in <a href="https://github.com/instantiator/semantic-kernel-experiment/blob/main/SKE/KernelSkillsExtensions.cs"><code>SKE.KernelSkillsExtensions</code></a>.</p>
<h4 id="semantic-functions">Semantic functions</h4>
<p>Semantic Functions are imported from their position in the skills directory tree. Each Skill has its own directory, and each function has a directory within there.</p>
<p>In this solution, all Skills are grouped inside the <code>Skills</code> directory:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="n">kernel</span><span class="p">.</span><span class="n">ImportSemanticSkillFromDirectory</span><span class="p">(</span><span class="n">scanDirectory</span><span class="p">,</span> <span class="n">skill</span><span class="p">);</span>
</span></span></code></pre></div><p>Each Skill contains two files:</p>
<ul>
<li><code>skprompt.txt</code> - the instructions for a text completion model that represent this capability</li>
<li><code>config.json</code> - various pieces of information used to fine tune the function</li>
</ul>
<p><code>config.json</code> is optional, however of all the information in that file, the <a href="https://github.com/instantiator/semantic-kernel-experiment/blob/main/SKE/Skills/MeaningSkill/ReverseMeaningFunction/config.json#L4">description</a> text is important for the Planner, as it needs it to understand what the function does.</p>
<p>eg.</p>
<p><code>skprompt.txt</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Reverse the meaning of the following, giving the opposite effect to the original intention.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">---Begin Text---
</span></span><span class="line"><span class="cl">{{$input}}
</span></span><span class="line"><span class="cl">---End Text---
</span></span></code></pre></div><p>and</p>
<p><code>config.json</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;schema&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;completion&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Reverse the meaning of the text&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;completion&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;max_tokens&#34;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;temperature&#34;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;top_p&#34;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;presence_penalty&#34;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;frequency_penalty&#34;</span><span class="p">:</span> <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;input&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;parameters&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;input&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Text to reverse the meaning of&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;defaultValue&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="native-functions">Native functions</h4>
<p>Conversely, Native functions are imported by providing an object from a class containing a number of methods marked with the <code>[SKFunction]</code> annotation.</p>
<p>In this solution, they are detected by reflection - and then each class identified as a Skill is instantiated and imported:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="n">kernel</span><span class="p">.</span><span class="n">ImportSkill</span><span class="p">(</span><span class="n">skillObject</span><span class="p">!,</span> <span class="n">type</span><span class="p">.</span><span class="n">Name</span><span class="p">!);</span>
</span></span></code></pre></div><p>In this solution we define a simple native function:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">CharacterManipulationSkill</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="na">    [SKFunction(&#34;Return the text in all uppercase (aka capitals)&#34;)]</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">string</span> <span class="n">Uppercase</span><span class="p">(</span><span class="kt">string</span> <span class="n">input</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">=&gt;</span> <span class="n">input</span><span class="p">.</span><span class="n">ToUpper</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>It&rsquo;s pretty clear what it does to you or I by inspection of the code. Note that the <code>SKFunction</code> annotation contains a description of the function as its parameter. The Planner needs this to understand the function, so that it can incorporate it into any plans.</p>
<h4 id="the-planner">The planner</h4>
<p>Finally, the Planner itself is imported:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="n">kernel</span><span class="p">.</span><span class="n">ImportSkill</span><span class="p">(</span><span class="k">new</span> <span class="n">PlannerSkill</span><span class="p">(</span><span class="n">kernel</span><span class="p">));</span>
</span></span></code></pre></div><p>This is interesting - the <code>PlannerSkill</code> is passed an instance of the Kernel, and I believe that&rsquo;s because it need to be able to learn which Skills the Kernel has imported, in order to be able to reason about them.</p>
<h3 id="creating-a-plan">Creating a plan</h3>
<p>Once configured and with all the skills available to the Planner, the code goes on to prepare an ask - a plain language request for the Kernel.</p>
<p>This solution uses a very simple, fixed ask to help illustrate how the skills can be used together:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="c1">// provide a simple input and ask as an example</span>
</span></span><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">input</span> <span class="p">=</span> <span class="s">&#34;Yesterday I went to the London Prompt Engineers jam at Newspeak House. Brilliant to meet folks who want to experiment with the new technologies, and a great opportunity to muck out with Semantic Kernel. Can&#39;t recommend highly enough!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">ask</span> <span class="p">=</span> <span class="s">$&#34;Reverse the following and then deliver it as cockney rhyming slag in all caps: {input}&#34;</span><span class="p">;</span>
</span></span></code></pre></div><p>WIth the ask constructed, the Planner can be invoked to create a plan:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="c1">// create plan for the given ask</span>
</span></span><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">plan</span> <span class="p">=</span> <span class="k">await</span> <span class="n">kernel</span><span class="p">.</span><span class="n">CreatePlanAsync</span><span class="p">(</span><span class="n">planner</span><span class="p">,</span> <span class="n">ask</span><span class="p">);</span>
</span></span></code></pre></div><p>Again, this takes place in an extension method - this time it&rsquo;s an async invocation, as the Kernel will be making calls to the remote LLM to complete the plan:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">await</span> <span class="n">kernel</span><span class="p">.</span><span class="n">RunAsync</span><span class="p">(</span><span class="n">ask</span><span class="p">,</span> <span class="n">planner</span><span class="p">[</span><span class="s">&#34;CreatePlan&#34;</span><span class="p">]);</span>
</span></span></code></pre></div><h3 id="executing-the-plan">Executing the plan</h3>
<p>Finally, the Kernel is asked to execute the plan:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="c1">// execute the plan</span>
</span></span><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">kernel</span><span class="p">.</span><span class="n">ExecutePlanAsync</span><span class="p">(</span><span class="n">planner</span><span class="p">,</span> <span class="n">plan</span><span class="p">);</span>
</span></span></code></pre></div><p>Again, this is covered in an extension method, but this conceals quite a bit of complexity:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">string?</span><span class="p">&gt;</span> <span class="n">ExecutePlanAsync</span><span class="p">(</span><span class="k">this</span> <span class="n">IKernel</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">IDictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">ISKFunction</span><span class="p">&gt;</span> <span class="n">planner</span><span class="p">,</span> <span class="n">SKContext</span> <span class="n">plan</span><span class="p">,</span> <span class="kt">int</span> <span class="n">maxSteps</span> <span class="p">=</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">string?</span> <span class="n">result</span> <span class="p">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">executionResults</span> <span class="p">=</span> <span class="n">plan</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">partialResults</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">step</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
</span></span></code></pre></div><p>After a little set up, it starts a <code>while</code> loop - which will stop when the plan is complete, or has exceeded the maximum number of permissible steps&hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(!</span><span class="n">executionResults</span><span class="p">.</span><span class="n">Variables</span><span class="p">.</span><span class="n">ToPlan</span><span class="p">().</span><span class="n">IsComplete</span> <span class="p">&amp;&amp;</span> <span class="n">step</span> <span class="p">&lt;</span> <span class="n">maxSteps</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span></code></pre></div><p>It executes the next step found in the plan (stored in <code>executionResults</code>). These execution results double as the output from executing a step, and information about execution of the plan itself.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">        <span class="c1">// execute the next step found in execution results</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">results</span> <span class="p">=</span> <span class="k">await</span> <span class="n">kernel</span><span class="p">.</span><span class="n">RunAsync</span><span class="p">(</span><span class="n">executionResults</span><span class="p">.</span><span class="n">Variables</span><span class="p">,</span> <span class="n">planner</span><span class="p">[</span><span class="s">&#34;ExecutePlan&#34;</span><span class="p">]);</span>
</span></span></code></pre></div><p>Then, assuming that the execution was successful, the output from the current step is captured in <code>result</code>, and also added to the <code>partialResults</code> list (mainly for debugging purposes).</p>
<p>If execution failed, this is where the method throws a <code>PlanExecutionException</code>, which contains all the debugging information available right now.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">Variables</span><span class="p">.</span><span class="n">ToPlan</span><span class="p">().</span><span class="n">IsSuccessful</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span> <span class="p">=</span> <span class="n">results</span><span class="p">.</span><span class="n">Variables</span><span class="p">.</span><span class="n">ToPlan</span><span class="p">().</span><span class="n">Result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">partialResults</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="n">PlanExecutionException</span><span class="p">(</span><span class="s">$&#34;Step {step} execution failed.&#34;</span><span class="p">,</span> <span class="n">plan</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">partialResults</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></div><p>Finally, <code>results</code> from the current step&rsquo;s execution are put into <code>executionResults</code>, which will be used to provide the next step of the plan when the loop iterates.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">        <span class="c1">// iterate - using the execution results as the input for the next step</span>
</span></span><span class="line"><span class="cl">        <span class="n">executionResults</span> <span class="p">=</span> <span class="n">results</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">step</span><span class="p">++;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p>When the loop has completed, if it has not thrown an exception, then there should be a final result in <code>result</code>&hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>The final line of <code>Program.Main</code> prints this final result to the console:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&#34;Result:\n\n{result}&#34;</span><span class="p">);</span>
</span></span></code></pre></div><h2 id="doing-it-right">Doing it right</h2>
<p>As with all other applications for Machine Learning, using Large Language Models to solve problems comes with hurdles and caveats.</p>
<p>Take the time to read the <a href="https://learn.microsoft.com/en-us/semantic-kernel/responsibleai">Responsible AI Transparency Note</a> provided with the Semantic Kernel documentation.</p>
<blockquote>
<p>An AI system includes not only the technology, but also the people who will use it, the people who will be affected by it, and the environment in which it is deployed. Creating a system that is fit for its intended purpose requires an understanding of how the technology works, what its capabilities and limitations are, and how to achieve the best performance.</p>
</blockquote>
<p>Think hard about how you will apply artificial intelligence and machine learning to your problems, and don&rsquo;t be afraid to speak out if you see a risk to any users. Aim to build tools that help everyone equally, and take the time to eliminate bias wherever it may creep in.</p>
<p><a href="https://leaddev.com/tech/lets-mitigate-bias-tech">Let&rsquo;s mitigate bias in tech</a> by Leslie Chapman is a good read.</p>
<blockquote>
<p>Try this exercise: gather ten people and have each one put together a list of what they think a truly diverse pool of users looks like. Then compare notes. I bet everyone has someone that they’ve missed on that list.</p>
</blockquote>
<blockquote>
<p>No company sets out to create a product that’s going to be called “racist” – but it happens over and over again. You can be the voice that helps your company avoid that from ever taking place.</p>
</blockquote>
</div>
        <div class="post-footer">
            <div class="info">
                <span class="separator"><a class="category" href="/categories/tutorial/">tutorial</a></span>
                <span class="separator"><a class="tag" href="/tags/gpt/">GPT</a><a class="tag" href="/tags/largelanguagemodel/">LargeLanguageModel</a><a class="tag" href="/tags/llm/">LLM</a><a class="tag" href="/tags/semantic-kernel/">semantic-kernel</a><a class="tag" href="/tags/sdk/">sdk</a><a class="tag" href="/tags/c%23/">c#</a><a class="tag" href="/tags/%2enet/">.net</a><a class="tag" href="/tags/textcompletion/">TextCompletion</a><a class="tag" href="/tags/artificialintelligence/">ArtificialIntelligence</a><a class="tag" href="/tags/ai/">AI</a><a class="tag" href="/tags/machine-learning/">machine-learning</a><a class="tag" href="/tags/ml/">ML</a><a class="tag" href="/tags/openai/">OpenAI</a><a class="tag" href="/tags/microsoft/">microsoft</a><a class="tag" href="/tags/software-development/">software-development</a><a class="tag" href="/tags/dev/">dev</a><a class="tag" href="/tags/csharp/">CSharp</a><a class="tag" href="/tags/coding/">coding</a><a class="tag" href="/tags/api/">API</a></span>
                

            </div>
        </div>

        
    </div>


        </div>
    </div>
</div>

<script type="text/javascript"
        src="/js/medium-zoom.min.e1c6918cbaa90022a5612f0bd71c7bf3be6d036614c5729cebfe14f7b91fa4bc.js"
        integrity="sha256-4caRjLqpACKlYS8L1xx7875tA2YUxXKc6/4U97kfpLw="
        crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SHE42ZWKEN"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-SHE42ZWKEN');
</script></body>

</html>
